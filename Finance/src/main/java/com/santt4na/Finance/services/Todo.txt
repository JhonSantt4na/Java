//Responsabilidades:
//Criar transa√ß√£o
//Validar:
//	usu√°rio
//	conta
//	categoria (se j√° criou)
//tipo (RECEITA/DESPESA)
//Atualizar saldo da conta
//Lidar com recorr√™ncia


## üü¢ `createTransaction(UUID userId, UUID accountId, Transaction transaction)`

### Checklist de responsabilidades:

1. **Validar entrada**

   * Verificar se `userId` n√£o √© nulo
   * Verificar se `accountId` n√£o √© nulo
   * Verificar se `transaction` n√£o √© nula
   * Validar campos obrigat√≥rios da transa√ß√£o:

     * `amount`
     * `date`
     * `type`
     * `account` (ou ser√° setada depois)
     * `user` (ou ser√° setado depois)

2. **Buscar usu√°rio**

   * Buscar usu√°rio pelo `userId`
   * Lan√ßar exce√ß√£o se n√£o existir

3. **Buscar conta**

   * Buscar conta pelo `accountId`
   * Garantir que a conta pertence ao usu√°rio
   * Lan√ßar exce√ß√£o se n√£o pertencer

4. **Associar entidades**

   * Setar `transaction.user`
   * Setar `transaction.account`
   * Definir `status` inicial (ex: `PENDING` ou `OPEN`)

5. **Tratar recorr√™ncia (se existir)**

   * Verificar se `transaction.getRecurrence()` n√£o √© nulo
   * Validar frequ√™ncia
   * Ativar recorr√™ncia se aplic√°vel

6. **Salvar transa√ß√£o**

   * Persistir a transa√ß√£o no banco

7. **Atualizar saldo da conta**

   * Se transa√ß√£o for do tipo:

     * `EXPENSE` ‚Üí subtrair valor
     * `INCOME` ‚Üí somar valor
   * Usar `AccountService.updateBalance`

8. **Log**

   * Logar cria√ß√£o da transa√ß√£o
   * Logar ID da transa√ß√£o criada
   * Logar usu√°rio e conta envolvidos

9. **Retorno**

   * Retornar a transa√ß√£o persistida

---

## üü° `listTransactionsByMonth(UUID userId, YearMonth month)`

### Checklist de responsabilidades:

1. **Validar entrada**

   * Verificar se `userId` n√£o √© nulo
   * Verificar se `month` n√£o √© nulo

2. **Buscar usu√°rio**

   * Confirmar que o usu√°rio existe
   * Lan√ßar exce√ß√£o se n√£o existir

3. **Calcular intervalo de datas**

   * `startDate = month.atDay(1)`
   * `endDate = month.atEndOfMonth()`

4. **Buscar transa√ß√µes**

   * Buscar transa√ß√µes do usu√°rio dentro do intervalo
   * Filtrar por data (`BETWEEN`)

5. **Ordena√ß√£o**

   * Ordenar por data (ASC ou DESC)
   * Opcional: ordenar por tipo ou status

6. **Log**

   * Logar usu√°rio
   * Logar m√™s consultado
   * Logar quantidade de registros retornados

7. **Retorno**

   * Retornar lista de transa√ß√µes

---

## üîµ `markAsPaid(UUID transactionId, UUID userId)`

### Checklist de responsabilidades:

1. **Validar entrada**

   * Verificar se `transactionId` n√£o √© nulo
   * Verificar se `userId` n√£o √© nulo

2. **Buscar transa√ß√£o**

   * Buscar transa√ß√£o pelo ID
   * Lan√ßar exce√ß√£o se n√£o existir

3. **Validar pertencimento**

   * Verificar se a transa√ß√£o pertence ao usu√°rio
   * Lan√ßar exce√ß√£o se n√£o pertencer

4. **Validar status atual**

   * Garantir que n√£o esteja j√° como `PAID`
   * Evitar pagamento duplicado

5. **Atualizar status**

   * Setar `status = PAID`

6. **Atualizar saldo**

   * Aplicar impacto financeiro:

     * Despesa ‚Üí subtrair
     * Receita ‚Üí somar

7. **Salvar transa√ß√£o**

   * Persistir altera√ß√£o

8. **Log**

   * Logar pagamento efetuado
   * Logar ID da transa√ß√£o
   * Logar valor

9. **Retorno**

   * M√©todo `void`, apenas efeito colateral

---

## üü£ `generateNextMonthRecurringTransactions(UUID userId)`

### Checklist de responsabilidades:

1. **Validar entrada**

   * Verificar se `userId` n√£o √© nulo

2. **Buscar usu√°rio**

   * Confirmar exist√™ncia do usu√°rio

3. **Buscar transa√ß√µes recorrentes**

   * Buscar transa√ß√µes do usu√°rio:

     * Com recorr√™ncia ativa
     * Status compat√≠vel (ex: `PAID` ou `OPEN`)

4. **Iterar transa√ß√µes**
   Para cada transa√ß√£o recorrente:

   * Calcular pr√≥xima data (via `RecurrenceService`)
   * Ignorar se frequ√™ncia for `ONCE`
   * Ignorar se data j√° foi gerada

5. **Criar nova transa√ß√£o**

   * Copiar:

     * `amount`
     * `description`
     * `type`
     * `account`
     * `user`
   * Setar nova `date`
   * Setar status inicial (`PENDING`)

6. **Salvar nova transa√ß√£o**

   * Persistir no banco

7. **Atualizar data base**

   * Atualizar data da transa√ß√£o original
   * Persistir atualiza√ß√£o

8. **Log**

   * Logar gera√ß√£o autom√°tica
   * Logar ID original e novo ID
   * Logar frequ√™ncia

9. **Retorno**

   * M√©todo `void`
   * Apenas processamento interno

---

## üß† Observa√ß√£o de Arquiteto (importante)

Seu `TransactionService` deve ser:

* **Orquestrador**
* N√£o conter regra de recorr√™ncia pesada
* Delegar c√°lculo de datas ao `RecurrenceService`
* Delegar saldo ao `AccountService`
